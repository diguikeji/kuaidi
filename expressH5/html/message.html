<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>消息中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="../css/app.css">
	<link rel="stylesheet" href="../css/mui.min.css">
	<style>
		body,.mui-content{background: #fff!important;}
		
		.express-list{padding:0 0.1rem;}
		.express-list li{border-bottom:1px solid rgba(243, 243, 243, 1);
		    box-sizing: border-box; color:#666;font-size:0.14rem; padding: 0.1rem 0rem;}
		
		.item img{
			width: 0.3rem;
			height: 0.3rem;
			margin-right: 0.1rem;
		}
		
		.content_wrap{
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			margin-right: 0.1rem;
		}
		
		.title{
			font-size: 0.2rem;
			margin-bottom: 0.1rem;
		}
		
		.time{
			font-size: 0.18rem;
		}

	</style>



</head>

<body>

		<header class="mui-bar mui-bar-nav" >
		    <img src="../images/back.png" class="mui-action-back">	
		    <h1 class="mui-title">消息中心</h1>
		</header>


<!--下拉刷新容器-->
<div id="pullrefresh" class="mui-content mui-scroll-wrapper express-col express-search">
	<div class="mui-scroll">
		<!--数据列表-->
		<ul class="express-list">

			<li class="row_between item">
				<img src="../images/app.png" >
				<div class="content_wrap">
					<span class="title">标题</span>
					<span>内容内容内容内容内容内容内容内容内容内容内容内容内容</span>
				</div>
				<span class="flex_one"></span>
				<span class="time">2019.1.30</span>
			</li>
			
			<li class="row_between item">
				<img src="../images/app.png" >
				<div class="content_wrap">
					<span class="title">标题</span>
					<span>内容内容内容内容内容内容内容内容内容内容内容内容内容</span>
				</div>
				<span class="flex_one"></span>
				<span class="time">2019.1.30</span>
			</li>
			
			<li class="row_between item">
				<img src="../images/app.png" >
				<div class="content_wrap">
					<span class="title">标题</span>
					<span>内容内容内容内容内容内容内容内容内容内容内容内容内容</span>
				</div>
				<span class="flex_one"></span>
				<span class="time">2019.1.30</span>
			</li>
			
			<li class="row_between item">
				<img src="../images/app.png" >
				<div class="content_wrap">
					<span class="title">标题</span>
					<span>内容内容内容内容内容内容内容内容内容内容内容内容内容</span>
				</div>
				<span class="flex_one"></span>
				<span class="time">2019.1.30</span>
			</li>

		</ul>
	</div>
</div>

<div class="empty_text hideClass">
	数据为空
</div>

<script src="../js/mui.js"></script>
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/myStorage.js"></script>
<script src="../js/app.js"></script>

<script>
	var h5pullDown = true;
	mui.init({
		pullRefresh: {
			container: '#pullrefresh',
			down: {
				callback: pulldownRefresh
			},
			up: {
				contentrefresh: '正在加载...',
				callback: pullupRefresh
			}
		}
	});
	/**
	 * 下拉刷新具体业务实现
	 */
	function pulldownRefresh() {
		setTimeout(function() {

			page=1;
			//getData(page);
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
		}, 1500);
	}
	var count = 0;
	/**
	 * 上拉加载具体业务实现
	 */
	function pullupRefresh() {
		setTimeout(function() {
			mui('#pullrefresh').pullRefresh().endPullupToRefresh(isEnd); //参数为true代表没有更多数据了。
			//getData(page);
		}, 1500);
	}
	if (mui.os.plus) {
		mui.plusReady(function() {

			setTimeout(function() {
				mui('#pullrefresh').pullRefresh().pullupLoading();
			}, 1000);

			commonEvent();
			getData(page);




		});
	} else {
		mui.ready(function() {
			mui('#pullrefresh').pullRefresh().pullupLoading();
		});
	}

	function getData(pageIndex)
	{
		Global.commonAjax({
					url: "express/search?sn="+$("#searchText").val()+"&page="+pageIndex

				},
				function(data) {

					console.log(JSON.stringify(data));

					if(data)
					{
						var html="";

						if(data.data.length>0)
						{
							for(var i=0;i<data.data.length;i++)
							{
								//console.log(JSON.stringify(data.data[i]));

								html=html+'<li data-id="'+data.data[i].id+'"><div class="clearfix top">' +
										'<div class="left">' +
										'<div class="name">'+data.data[i].from_name+'</div>' +
										'<p>'+data.data[i].from_province+data.data[i].from_city+data.data[i].from_area+data.data[i].from_detail+'</p>' +
										'</div>' +
										'<img class="middle-img" src="../images/secondPage/express_22.jpg">' +
										'<div class="right">' +
										'<div class="name">'+data.data[i].to_name+'</div>' +
										'<p>'+data.data[i].to_province+data.data[i].to_city+data.data[i].to_area+data.data[i].to_detail+'</p>' +
										'</div>' +
										'</div>' +
										'<div class="middle">' +
										'<span class="first"><span></span>未签收</span>' +
										'<span class="second">'+data.data[i].to_company_name+'</span>' +
										'</div>' +
										'<div class="bottom">' +
										'<img src="../images/secondPage/express_27.jpg"/>' +
										'<span class="first">顺丰快递</span>' +
										'<span>'+data.data[i].express_sn+'</span>' +
										'</div>' +
										'</li>';
							}

							page++;;

							$(".express-list").append(html);
						}
						else
						{
							isEnd=1;
						}


						if(pageIndex==1&&data.data.length==0)
						{
							$(".empty_text").show();
						}
					}
				},
				function(err) {

					console.log("err");

				})
	}

	var page=1;
	var isEnd=0;

	mui(".express-list").on('tap', 'li ', function() {

		var id=$(this).attr("data-id");

		Global.openWindow({
			url:"message_detail.html",
			id: "message_detail.html.html",
			waiting: {
				autoShow: false
			}
		})

	})


</script>
</body>

</html>